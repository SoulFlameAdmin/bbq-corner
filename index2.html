<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Corner BBQ ‚Äî –ö–∞—Ç–µ–≥–æ—Ä–∏—è</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

<style>
:root{
  --gap:16px;
  --soft:#00000014;
  --shadow:0 10px 28px rgba(0,0,0,.16);
  --accent:#ff7a00;
  --radius:20px;
  --home-closed:110px;
  --home-open:150px;
  --popShadow:0 22px 60px rgba(0,0,0,.28);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:#111;background:#fff}

/* –õ–µ–π–∞—É—Ç */
.app{min-height:100dvh;display:grid;grid-template-columns:260px 1fr}
@media (max-width:1100px){.app{grid-template-columns:220px 1fr}}
@media (max-width:900px){.app{grid-template-columns:1fr}}

/* Sidebar */
.sidebar{
  position:sticky;top:0;height:100dvh;background:#fff;border-right:1px solid var(--soft);
  padding:20px 10px 16px 16px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;
  box-shadow:inset -10px 0 30px rgba(0,0,0,.05)
}
.sidebar::-webkit-scrollbar{display:none}
.sidebar-inner{display:flex;flex-direction:column;gap:14px}
.cat{
  display:block;text-decoration:none;background:#fff;border:1px solid var(--soft);
  border-radius:24px;padding:10px;box-shadow:var(--shadow);cursor:pointer;
  transform-style:preserve-3d; will-change:transform, box-shadow, filter;
  transition:transform .24s cubic-bezier(.22,.8,.36,1), box-shadow .24s ease, filter .24s ease;
  outline-offset:3px;
}
.cat .box{position:relative;height:118px;border-radius:14px;overflow:hidden;background:#e9ecef center/cover no-repeat}
.cat .box::after{
  content:attr(data-label);position:absolute;left:0;right:0;bottom:0;padding:10px 14px;
  font-weight:900;letter-spacing:.6px;color:#fff;text-shadow:0 2px 3px rgba(0,0,0,.6);
  background:linear-gradient(180deg,transparent 0,rgba(0,0,0,.62) 100%)
}
.cat.active{outline:3px solid var(--accent)}

/* Hover pop */
@media (hover:hover){
  .cat:hover{
    transform:perspective(800px) translateY(-6px) scale(1.03) rotateX(1.5deg);
    box-shadow:var(--popShadow);
    filter:saturate(1.03) contrast(1.02);
  }
}

/* Press / Pop */
.cat.is-pressed{ transform:perspective(900px) translateY(-2px) scale(0.985) rotateX(.5deg) }
.cat.is-popping{
  transform:perspective(900px) translateY(-10px) scale(1.06) rotateX(3deg);
  box-shadow:var(--popShadow);
}

/* –õ–æ–≥–∞ –±–µ–∑ zoom */
.cat[data-cat="kola"] .box,
.cat[data-cat="xixo"] .box{
  background-size:contain;background-position:center;background-repeat:no-repeat;background-color:#fff;
}

/* Content + Home */
.content{position:relative;min-width:0;padding:80px 22px 28px}
.home-pill{
  position:absolute;top:16px;left:20px;z-index:10;height:48px;width:var(--home-closed);
  display:flex;align-items:center;justify-content:center;gap:10px;padding:0 12px;
  background:#ff7a00;color:#fff;border-radius:14px;box-shadow:var(--shadow);
  text-decoration:none;overflow:hidden;white-space:nowrap;transition:width .25s ease,padding .25s ease
}
.home-pill .bi{font-size:20px;line-height:1}
.home-pill span{font-weight:700;font-size:18px;letter-spacing:.3px;opacity:0;transform:translateX(8px);transition:opacity .2s ease,transform .2s ease}
.home-pill:hover{width:var(--home-open);justify-content:flex-start;padding:0 16px}
.home-pill:hover span{opacity:1;transform:translateX(0)}

/* CART button (–≥–æ—Ä–µ –≤–¥—è—Å–Ω–æ) */
.cart-btn{
  position:fixed;top:16px;right:20px;z-index:1100;
  display:flex;align-items:center;gap:10px;
  background:#111;color:#fff;border-radius:14px;padding:10px 14px;
  text-decoration:none;box-shadow:var(--shadow);cursor:pointer;user-select:none
}
.cart-btn .bi{font-size:20px}
.cart-count{
  min-width:22px;height:22px;border-radius:999px;background:#ff7a00;color:#fff;
  display:inline-flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;padding:0 6px
}

.h1{font-size:28px;font-weight:900;color:#ff7a00;letter-spacing:.6px;margin:0 0 18px}

/* –ó–∞–≥–ª–∞–≤–∏—è –Ω–∞ —Å–µ–∫—Ü–∏–∏ */
.sec-title{margin:14px 0 10px;font-weight:900;font-size:28px;color:#ff7a00;letter-spacing:.6px}

/* –ü—Ä–æ–¥—É–∫—Ç–æ–≤ –≥—Ä–∏–¥ */
.grid-products{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media (max-width:900px){.grid-products{grid-template-columns:1fr}}

/* –ö–∞—Ä—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç */
.product{
  background:#fff;border:1px solid var(--soft);border-radius:22px;box-shadow:var(--shadow);
  display:grid;grid-template-columns:360px 1fr;gap:16px;align-items:center;overflow:hidden
}
.product .photo{height:210px;background:#e9ecef center/cover no-repeat;margin:16px;border-radius:14px}
.product .pad{padding:12px 16px;display:flex;flex-direction:column;gap:8px;height:100%}
.product .title{font-weight:900;font-size:20px;margin:0}
.product.even{grid-template-columns:1fr 360px}
.product.even .photo{order:2;margin-left:0;margin-right:16px}
@media (max-width:1200px){.product{grid-template-columns:320px 1fr}.product.even{grid-template-columns:1fr 320px}.product .photo{height:200px}}
@media (max-width:760px){.product,.product.even{grid-template-columns:1fr}.product .photo{height:200px;margin:14px}.product.even .photo{order:0;margin:14px}}

/* –¶–µ–Ω–æ–≤–∏ –±–∞–¥–∂ + Add */
.price-badge{
  display:inline-block;margin-left:auto;margin-right:16px;margin-top:auto;
  background:#ff7a00;color:#fff;border-radius:12px 12px 12px 4px;
  padding:10px 12px 8px;line-height:1;text-align:right;min-width:110px;box-shadow:var(--shadow)
}
.price-badge .lv{font-weight:900;font-size:28px}
.price-badge .eur{font-size:18px;opacity:.95}
.add-btn{
  display:inline-block;margin:8px 16px 16px auto;
  background:#111;color:#fff;border:none;border-radius:10px;padding:8px 14px;
  font-weight:800;cursor:pointer;box-shadow:var(--shadow)
}
.add-btn:active{transform:translateY(1px)}

/* –ì–∞–ª–µ—Ä–∏—è (HELL) */
.gallery{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
@media (max-width:1200px){.gallery{grid-template-columns:repeat(3,1fr)}}
@media (max-width:900px){.gallery{grid-template-columns:repeat(2,1fr)}}
@media (max-width:600px){.gallery{grid-template-columns:1fr}}
.tile{
  background:#fff;border:1px solid var(--soft);border-radius:16px;box-shadow:var(--shadow);
  padding:12px;text-align:center;
}
.tile img{width:100%;height:220px;object-fit:contain;display:block;border-radius:12px}
.caption{margin-top:6px;font-weight:800;font-size:14px;text-align:center}
.tile .price-badge{margin:10px auto 4px;display:block;text-align:center;border-radius:12px}
.tile .add-btn{margin:10px auto 0;display:block}

/* –í–û–î–ê ‚Äî 2 –∫–æ–ª–æ–Ω–∏ */
.water-wrapper{display:flex;flex-direction:column;gap:26px;max-width:720px}
.water-block h2{margin:0 0 8px;font-size:24px;font-weight:900;color:#ff7a00}
.water-grid{display:grid;grid-template-columns:repeat(2, minmax(160px, 1fr));gap:16px;align-items:start}
.water-card{
  background:#fff;border:1px solid var(--soft);border-radius:16px;box-shadow:var(--shadow);
  padding:12px;text-align:center;
}
.water-card img{width:100%;height:220px;object-fit:contain;display:block;border-radius:12px}
.water-name{margin-top:8px;font-weight:800}
.water-card .price-badge{margin:10px auto 4px;display:block;text-align:center;border-radius:12px}
.water-card .add-btn{margin:8px auto 0;display:block}
@media (max-width:520px){.water-grid{grid-template-columns:1fr}}

/* –î–æ—Å—Ç—ä–ø–Ω–æ—Å—Ç */
@media (prefers-reduced-motion: reduce){ .cat{transition:none} }

/* === –ü–ª–∞–≤–∞—â–æ ‚Äû–ù–∞—á–∞–ª–æ‚Äú === */
.home-pill{ will-change: transform; }
.home-pill{ position: fixed !important; top: 16px; left: 20px; z-index: 1000; will-change: transform; }

/* === CART MODAL === */
.cart-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.2);
  backdrop-filter:blur(20px);
  display:none;align-items:flex-start;justify-content:flex-end;z-index:1200;
}
.cart-panel{
  width:min(560px, 100%);max-height:100dvh;overflow:auto;background:#fff;border-left:1px solid var(--soft);
  box-shadow:var(--popShadow);padding:18px 16px 20px;border-radius:16px 0 0 16px;
}
.cart-head{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.cart-head .title{font-size:22px;font-weight:900;color:#ff7a00}
.cart-close{margin-left:auto;background:transparent;border:none;font-size:22px;cursor:pointer}
.cart-items{display:flex;flex-direction:column;gap:12px}
.cart-item{
  display:grid;grid-template-columns:88px 1fr auto;gap:12px;align-items:center;
  background:#fff;border:1px solid var(--soft);border-radius:12px;padding:8px;box-shadow:var(--shadow)
}
.cart-item img{width:88px;height:66px;object-fit:cover;border-radius:10px;background:#e9ecef}
.cart-item .name{font-weight:800}
.cart-item .price{font-weight:900}
.cart-empty{padding:12px;font-weight:700;opacity:.7}
.cart-total{
  margin-top:14px;padding-top:12px;border-top:2px dashed var(--soft);
  display:flex;align-items:center;justify-content:space-between;font-weight:900;font-size:18px
}
.cart-actions{margin-top:12px;display:flex;justify-content:flex-end}
.order-btn{
  background:var(--accent);color:#fff;border:none;border-radius:12px;
  padding:12px 16px;font-weight:900;box-shadow:var(--shadow);cursor:pointer
}
.order-btn:disabled{opacity:.5;cursor:not-allowed}
</style>
</head>
<body>

<div class="app">
  <aside class="sidebar"><div class="sidebar-inner" id="sidebar"></div></aside>

  <main class="content">
    <!-- HOME -->
    <a class="home-pill" href="index.html" title="–ù–∞—á–∞–ª–æ">
      <i class="bi bi-house"></i><span>–ù–∞—á–∞–ª–æ</span>
    </a>

    <!-- CART BTN -->
    <button class="cart-btn" id="cartBtn" title="–ö–æ–ª–∏—á–∫–∞">
      <i class="bi bi-cart3"></i>
      <span>–ö–æ–ª–∏—á–∫–∞</span>
      <span class="cart-count" id="cartCount">0</span>
    </button>

    <h1 class="h1" id="catTitle">–ë–£–†–ì–ï–†–ò</h1>
    <div id="productGrid"></div>
  </main>
</div>

<!-- CART MODAL -->
<div class="cart-overlay" id="cartOverlay" aria-hidden="true">
  <div class="cart-panel" role="dialog" aria-modal="true">
    <div class="cart-head">
      <div class="title"><i class="bi bi-cart3"></i> –¢–≤–æ—è—Ç–∞ –∫–æ–ª–∏—á–∫–∞</div>
      <button class="cart-close" id="cartClose" aria-label="–ó–∞—Ç–≤–æ—Ä–∏"><i class="bi bi-x-lg"></i></button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-total" id="cartTotalRow" style="display:none">
      <span>–û–±—â–æ:</span>
      <span id="cartTotal"></span>
    </div>
    <div class="cart-actions">
      <button id="orderNow" class="order-btn" disabled>–ü–æ—Ä—ä—á–∞–π —Å–µ–≥–∞</button>
    </div>
  </div>
</div>

<script>
/* –ú–∏–Ω–∏–∞—Ç—é—Ä–∏ (—Å–∞–π–¥–±–∞—Ä) */
const CAT_THUMBS = {
  burgeri:'snimki/produkti/1menu/burger.jpg',
  palachinki:'snimki/produkti/1menu/palachinki.jpg',
  strandzhanki:'snimki/produkti/1menu/strandjanka.jpg',
  kartofi:'snimki/produkti/1menu/kartofi.jpg',
  salati:'snimki/produkti/1menu/salata.jpg',
  portsii:'snimki/produkti/1menu/porciq.jpg',
  sosove:'snimki/produkti/1menu/sosove.jpg',
  dobavki:'snimki/produkti/1menu/dobavki.jpg',
  deserti:'snimki/produkti/1menu/desert.jpg',
  bezalkoholni:'snimki/produkti/1menu/bezalkoholno.jpg',
  bira:'snimki/produkti/1menu/bira.jpg',
  hell:'snimki/produkti/1menu/hell.jpg',
  voda:'snimki/produkti/–í–û–î–ê/voda_snimka.jpg',
  gazirana_voda:'snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/gaziranavoda_snimka.jpg',
  fanta:'snimki/produkti/–§–ê–ù–¢–ê/fanta_logo.jpg',
  studen_chai:'snimki/produkti/–°–¢–£–î–ï–ù_–ß–ê–ô/studen_chai_logo.jpg',
  kola:'snimki/produkti/–ö–û–õ–ê/kola_logo.jpg',
  sok:'snimki/produkti/–°–û–ö/cappy_logo.jpg',
  airqn:'snimki/produkti/–ê–ô–†–ê–ù/vereq_logo.jpg',
  xixo:'snimki/produkti/–•–ò–•–û/xixo_logo.jpg'
};

/* –¶–µ–Ω–∏ ‚Äì –∫–æ–Ω–≤–µ—Ä—Ç–æ—Ä */
const BGN_PER_EUR = 1.95583;
const fmtLv  = v => (v).toFixed(2).replace('.',',') + ' –ª–≤.';
const fmtEur = v => (v / BGN_PER_EUR).toFixed(2).replace('.',',') + ' ‚Ç¨';

/* –ö–æ–ª–∏—á–∫–∞ */
const CART = [];
const cartBtn   = document.getElementById('cartBtn');
const cartCount = document.getElementById('cartCount');
const cartOverlay = document.getElementById('cartOverlay');
const cartItemsEl = document.getElementById('cartItems');
const cartTotalRow = document.getElementById('cartTotalRow');
const cartTotal = document.getElementById('cartTotal');
const orderNowBtn = document.getElementById('orderNow');

/* ====== LS –∫–ª—é—á–æ–≤–µ (index2 -> index3) ====== */
const LS_CART_ITEMS = 'bbq_cart_items';
const LS_CART_TOTAL = 'bbq_cart_total';

/* –î–æ–±–∞–≤—è–Ω–µ –∫—ä–º –∫–æ–ª–∏—á–∫–∞—Ç–∞ */
function addToCart(item){
  CART.push(item);
  updateCartUI();
}

/* –û—Å–Ω–æ–≤–µ–Ω —Ä–µ–Ω–¥–µ—Ä –Ω–∞ –∫–æ–ª–∏—á–∫–∞—Ç–∞ */
function updateCartUI(){
  cartCount.textContent = CART.length;

  if (CART.length === 0){
    cartItemsEl.innerHTML = `<div class="cart-empty">–ö–æ–ª–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.</div>`;
    cartTotalRow.style.display = 'none';
    orderNowBtn.disabled = true;
    persistCartSnapshot(); // –ø–∞–∑–∏–º ‚Äû–ø—Ä–∞–∑–Ω–æ‚Äú —Å—ä—Å—Ç–æ—è–Ω–∏–µ
    return;
  }

  cartItemsEl.innerHTML = CART.map(it => `
    <div class="cart-item">
      <img src="${it.img}" alt="${it.name}">
      <div>
        <div class="name">${it.name}</div>
        <div class="price">${fmtLv(it.price)} <span style="opacity:.75">(${fmtEur(it.price)})</span></div>
      </div>
      <div>
        <button class="add-btn" data-remove="${it._id}">‚úï</button>
      </div>
    </div>
  `).join('');

  // –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ
  cartItemsEl.querySelectorAll('[data-remove]').forEach((btn)=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-remove');
      const i = CART.findIndex(x => String(x._id) === id);
      if (i>=0){ CART.splice(i,1); updateCartUI(); }
    });
  });

  // –û–±—â–æ
  const total = CART.reduce((s, x)=> s + (Number(x.price)||0), 0);
  cartTotal.textContent = `${fmtLv(total)}  (${fmtEur(total)})`;
  cartTotalRow.style.display = '';
  orderNowBtn.disabled = CART.length === 0;

  // üîê –ü–∞–∑–∏–º —Å–Ω–∏–º–∫–∞ –Ω–∞ –∫–æ–ª–∏—á–∫–∞—Ç–∞ —Å–ª–µ–¥ –≤—Å—è–∫–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ
  persistCartSnapshot();
}

/* ====== Persist & Restore ====== */
function persistCartSnapshot(){
  try{
    const itemsSnapshot = CART.map(({_id, name, price, img}) => ({_id, name, price, img}));
    const total = CART.reduce((s, x)=> s + (Number(x.price)||0), 0);
    localStorage.setItem(LS_CART_ITEMS, JSON.stringify(itemsSnapshot));
    localStorage.setItem(LS_CART_TOTAL, String(total));
  }catch(e){ console.warn('LS error:', e); }
}

function restoreCartFromLS(){
  try{
    const raw = localStorage.getItem(LS_CART_ITEMS);
    if (!raw) return;
    const items = JSON.parse(raw);
    if (Array.isArray(items)){
      items.forEach(it => CART.push({
        _id: it._id || (Date.now()+''+Math.random()),
        name: it.name, price: Number(it.price)||0, img: it.img||''
      }));
      updateCartUI();
    }
  }catch(e){ console.warn('Restore LS error:', e); }
}

/* –û—Ç–≤–∞—Ä—è–Ω–µ/–∑–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ –º–æ–¥–∞–ª–∞ */
function openCart(){
  updateCartUI();
  cartOverlay.style.display = 'flex';
  cartOverlay.setAttribute('aria-hidden','false');
}
function closeCart(){
  cartOverlay.style.display = 'none';
  cartOverlay.setAttribute('aria-hidden','true');
}
document.getElementById('cartClose').addEventListener('click', closeCart);
cartOverlay.addEventListener('click', (e)=>{ if(e.target === cartOverlay) closeCart(); });
cartBtn.addEventListener('click', openCart);

/* –ü–æ—Ä—ä—á–∞–π —Å–µ–≥–∞ ‚Üí index3.html (–ª–æ–∫–∞–ª–Ω–æ –∏–ª–∏ —É–µ–±) */
orderNowBtn.addEventListener('click', ()=>{
  if (CART.length === 0) return;
  persistCartSnapshot(); // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞–º–µ –∑–∞–ø–∏—Å
  const target = (location.protocol === 'file:')
    ? 'file:///E:/BBQ_SITE/index3.html'
    : 'index3.html';
  window.location.href = target;
});

/* –ö–∞—Ç–∞–ª–æ–≥ —Å —Ü–µ–Ω–∏ –≤ –ª–≤. */
const CATALOG = {
  burgeri:{title:'–ë–£–†–ì–ï–†–ò',items:[
    {name:'–ö–û–ù–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:9.00,img:'snimki/produkti/2menu/konski.jpg'},
    {name:'–¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:9.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:9.50,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–°–í–ò–ù–°–ö–ê –í–ï–®–ê–õ–ò–¶–ê',price:9.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–ü–ò–õ–ï–®–ö–ò –°–¢–ï–ö',price:9.00,img:'snimki/produkti/2menu/pileshkistek.jpg'},
    {name:'–í–ï–ì–ï–¢–ê–†–ò–Ø–ù–°–ö–ò',price:5.00,img:'snimki/produkti/2menu/vegan.jpg'},
    {name:'–î–í–û–ô–ù–ê –®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:12.50,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–î–í–û–ô–ù–ê –ö–û–ù–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:12.00,img:'snimki/produkti/2menu/konski.jpg'},
    {name:'–î–í–û–ô–ù–ê –°–í–ò–ù–°–ö–ê –í–ï–®–ê–õ–ò–¶–ê',price:12.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–î–í–û–ï–ù –ü–ò–õ–ï–®–ö–ò –°–¢–ï–ö',price:12.00,img:'snimki/produkti/2menu/pileshkistek.jpg'},
    {name:'–î–í–û–ô–ù–ê –¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:12.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–ë–£–†–ì–ï–† –° –î–™–†–ü–ê–ù–û –¢–ï–õ–ï–®–ö–û',price:12.50,img:'snimki/produkti/2menu/durpano.jpg'},
  ]},

  palachinki:{
    title:'–ü–ê–õ–ê–ß–ò–ù–ö–ò',
    groups:[
      { heading:'–°–õ–ê–î–ö–ò', items:[
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° NUCREMA –®–û–ö–û–õ–ê–î',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/shokolad.jpg'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° NUCREMA –®–û–ö–û–õ–ê–î –ò –ë–ê–ù–ê–ù',price:6.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/shokoladibanan.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –° –ú–ï–î –ò –û–†–ï–•–ò',price:5.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/mediorehi.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –ë–û–†–û–í–ò–ù–ö–ò',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/borovinki.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –ü–†–ê–°–ö–û–í–ê',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/praskovi.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –Ø–ì–û–î–ò',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/qgodi.png'},
      ]},
      { heading:'–°–û–õ–ï–ù–ò', items:[
        {name:'–°–ò–†–ï–ù–ï –ò –°–õ–ê–î–ö–û',price:5.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/sirene.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–ò–†–ï–ù–ï',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/sirene.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –ö–ê–®–ö–ê–í–ê–õ',price:5.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/kashkaval.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–ò–†–ï–ù–ï –ò –ö–ê–®–ö–ê–í–ê–õ',price:6.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/kashkavalisirene.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –° –ú–ê–°–õ–û',price:4.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/maslo.png'},
      ]}
    ]
  },

  strandzhanki:{ title:'–°–¢–†–ê–ù–î–ñ–ê–ù–ö–ò', items:[
    {name:'–¢–ï–õ–ï–®–ö–ê –°–¢–†–ê–ù–î–ñ–ê–ù–ö–ê',price:5.00,img:CAT_THUMBS.strandzhanki},
    {name:'–°–í–ò–ù–°–ö–ê –°–¢–†–ê–ù–î–ñ–ê–ù–ö–ê',price:5.00,img:CAT_THUMBS.strandzhanki},
  ]},

  kartofi:{ title:'–ö–ê–†–¢–û–§–ò', items:[
    {name:'–ü–™–†–ñ–ï–ù–ò –ö–ê–†–¢–û–§–ò 200 –ì–†–ê–ú–ê',price:4.00,img:'snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofi.jpg'},
    {name:'–ö–ê–†–¢–û–§–ò –° –ß–ï–î–™–† –ò –ë–ï–ö–û–ù',price:6.50,img:'snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofisbekonichedur.jpg'},
    {name:'–ö–ê–†–¢–û–§–ò –° –ß–ï–î–™–†',price:5.00,img:'snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofischedur.jpg'},
  ]},

  salati:{ title:'–°–ê–õ–ê–¢–ò', items:[
    {name:'–°–ê–õ–ê–¢–ê –¶–ï–ó–ê–†', price:8.50, img:CAT_THUMBS.salati},
  ]},

  portsii:{ title:'–ü–û–†–¶–ò–ò', items:[
    {name:'–†–ê–ó–Ø–î–ö–ê 100 –ì–†–ê–ú–ê',price:1.50,img:CAT_THUMBS.portsii},
    {name:'–ü–ò–¢–ö–ê 1 –ë–†–û–ô',price:1.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/pitka.jpg'},
    {name:'–¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê –ü–û–†–¶–ò–Ø',price:11.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/sharsko.jpg'},
    {name:'–ü–ò–õ–ï–®–ö–û –§–ò–õ–ï –ü–û–†–¶–ò–Ø',price:11.00,img:'snimki/produkti/–ü–û–†–¶–ò–ò/pileshko.jpg'},
    {name:'–°–í–ò–ù–°–ö–û –§–ò–õ–ï –ü–û–†–¶–ò–Ø',price:11.00,img:'snimki/produkti/–ü–û–†–¶–ò–ò/svinsko.jpg'},
    {name:'–¢–ï–õ–ï–®–ö–ò –ö–ï–ë–ê–ü–ß–ï–¢–ê –ü–û–†–¶–ò–Ø',price:9.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/kebapche.jpg'},
    {name:'–®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê –ü–û–†–¶–ò–Ø',price:12.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/sharsko.jpg'},
  ]},

  dobavki:{ title:'–î–û–ë–ê–í–ö–ò', items:[
    {name:'–°–ò–†–ï–ù–ï 100 –ì–†–ê–ú–ê',  price:1.50},
    {name:'–ö–ê–®–ö–ê–í–ê–õ 100 –ì–†–ê–ú–ê',price:1.50},
    {name:'–î–†–ï–°–ò–ù–ì –î–û–ë–ê–í–ö–ê',   price:1.00},
    {name:'–ú–ï–°–û –î–û–ë–ê–í–ö–ê',      price:4.00},
    {name:'–ü–ò–¢–ö–ê',             price:1.50},
  ]},

  sosove:{ title:'–°–û–°–û–í–ï', items:[
    {name:'–î–û–ú–ê–®–ù–ê –†–ê–ó–Ø–î–ö–ê 100–ì–†', price:1.50, img:CAT_THUMBS.sosove},
    {name:'–î–û–ú–ê–®–ù–ê –ú–ê–ô–û–ù–ï–ó–ê',     price:1.50, img:CAT_THUMBS.sosove},
    {name:'–õ–Æ–¢–ï–ù–ò–¶–ê',             price:1.50, img:CAT_THUMBS.sosove},
    {name:'–ö–ï–¢–ß–£–ü',               price:1.00, img:CAT_THUMBS.sosove},
    {name:'–ì–û–†–ß–ò–¶–ê',              price:1.00, img:CAT_THUMBS.sosove},
    {name:'–°–û–° –¶–ï–ó–ê–†',            price:1.50, img:CAT_THUMBS.sosove},
  ]},

  deserti:{ title:'–î–ï–°–ï–†–¢–ò', items:[
    {name:'–õ–ï–ö –î–ï–°–ï–†–¢ –° –ß–ò–Ø, –ú–Æ–°–õ–ò –ò –°–£–®–ï–ù–ò –ü–õ–û–î–û–í–ï',price:4.50,img:CAT_THUMBS.deserti},
    {name:'–õ–ï–ö –î–ï–°–ï–†–¢ –° –ß–ò–Ø, –ú–Æ–°–õ–ò –ò –°–õ–ê–î–ö–û –û–¢ –ë–û–†–û–í–ò–ù–ö–ò',price:4.50,img:CAT_THUMBS.deserti},
  ]},

  bezalkoholni:{ title:'–ë–ï–ó–ê–õ–ö–û–•–û–õ–ù–ò', items:[
    {name:'–ö–û–õ–ê –ö–ï–ù',price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:'–§–ê–ù–¢–ê –ü–û–†–¢–û–ö–ê–õ –ö–ï–ù',price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:'–ö–û–ö–ê –ö–û–õ–ê –ë–£–¢–ò–õ–ö–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–§–ê–ù–¢–ê –ü–û–†–¢–û–ö–ê–õ –ë–£–¢–ò–õ–ö–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–°–ü–†–ê–ô–¢ –ë–£–¢–ò–õ–ö–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–°–¢–£–î–ï–ù –ß–ê–ô',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–ö–ê–ü–ò –ü–™–õ–ü–ò',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–ö–ê–ü–ò –ö–£–¢–ò–Ø',price:1.70,img:CAT_THUMBS.bezalkoholni},
    {name:'–°–û–î–ê –ë–£–¢–ò–õ–ö–ê',price:1.90,img:CAT_THUMBS.bezalkoholni},
    {name:'–ú–ê–õ–ö–ê –ú–ò–ù–ï–†–ê–õ–ù–ê –í–û–î–ê',price:1.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–ì–û–õ–Ø–ú–ê –ú–ò–ù–ï–†–ê–õ–ù–ê –í–û–î–ê',price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:'–ö–ê–ü–ò –õ–ò–ú–û–ù–ê–î–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–¢–û–ù–ò–ö –ë–£–¢–ò–õ–ö–ê',price:1.90,img:CAT_THUMBS.bezalkoholni},
  ]},

  bira:{ title:'–ë–ò–†–ê', items:[
    {name:'–ë–ò–†–ê –ö–û–†–û–ù–ê',price:3.50,img:CAT_THUMBS.bira},
    {name:'–•–ê–ô–ù–ò–ö–ï–ù',price:4.00,img:CAT_THUMBS.bira},
    {name:'–°–¢–ï–õ–ê –ê–†–¢–û–ê',price:4.50,img:CAT_THUMBS.bira},
  ]},

  hell:{
    title:'HELL',
    view:'gallery',
    hellPrice:2.00,
    groups:[
      { heading:'HELL', images:[
          'snimki/hell_sminki/normal/hell_apple.jpg',
          'snimki/hell_sminki/normal/hell_clasic.jpg',
          'snimki/hell_sminki/normal/hell_classic.jpg',
          'snimki/hell_sminki/normal/hell_redgrape.jpg',
          'snimki/hell_sminki/normal/hell_watermelon.jpg'
      ]},
      { heading:'ICE COFFE HELL', images:[
          'snimki/hell_sminki/ice_coffe/ice_coffe_capochino.png',
          'snimki/hell_sminki/ice_coffe/ice_coffe_caramel.png',
          'snimki/hell_sminki/ice_coffe/ice_coffe_coconut.png',
          'snimki/hell_sminki/ice_coffe/ice_coffe_doubleespresso.png',
          'snimki/hell_sminki/ice_coffe/ice_coffe_late.png',
          'snimki/hell_sminki/ice_coffe/ice_coffe_pinklatte.png',
          'snimki/hell_sminki/ice_coffe/ice_coffe_vanilia.png',
          'snimki/hell_sminki/ice_coffe/ice_hell_distachio.png'
      ]}
    ]
  },

  voda:{
    title:'–í–û–î–ê',
    view:'water2',
    groups:[
      { heading:'Devin', pair:[
          {src:'snimki/produkti/–í–û–î–ê/golqma_devin.jpg', label:'–ì–æ–ª—è–º–∞ –î–µ–≤–∏–Ω', price:2.00},
          {src:'snimki/produkti/–í–û–î–ê/malka_devin.jpg', label:'–ú–∞–ª–∫–∞ –î–µ–≤–∏–Ω',  price:1.50}
      ]},
      { heading:'–ë–∞–Ω–∫—è', pair:[
          {src:'snimki/produkti/–í–û–î–ê/golqma_bankq.jpg', label:'–ì–æ–ª—è–º–∞ –ë–∞–Ω–∫—è', price:2.00},
          {src:'snimki/produkti/–í–û–î–ê/malka_bankq.jpg', label:'–ú–∞–ª–∫–∞ –ë–∞–Ω–∫—è',  price:1.50}
      ]}
    ]
  },

  gazirana_voda:{
    title:'–ì–ê–ó–ò–†–ê–ù–ê –í–û–î–ê',
    view:'water2',
    groups:[
      { heading:'–ú–∞—Ä–∫–∏', pair:[
          {src:'snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/shveps.jpg',  label:'Schweppes', price:1.90},
          {src:'snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/sprait.jpg',  label:'Sprite',    price:1.90}
      ]}
    ]
  },

  fanta:{
    title:'–§–ê–ù–¢–ê',
    items:[
      {name:'–§–∞–Ω—Ç–∞ –ü–æ—Ä—Ç–æ–∫–∞–ª',      price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_portokal.jpg'},
      {name:'–§–∞–Ω—Ç–∞ –õ–∏–º–æ–Ω',         price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_lemon.jpg'},
      {name:'–§–∞–Ω—Ç–∞ –õ–∞–π—á–∏',         price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_laici.jpg'},
      {name:'–§–∞–Ω—Ç–∞ Tutti Frutti',  price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_tutti.jpg'},
      {name:'–§–∞–Ω—Ç–∞ –ó–µ–ª–µ–Ω–∞ —è–±—ä–ª–∫–∞', price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_greenapple.jpg'},
      {name:'–§–∞–Ω—Ç–∞ –ë–æ—Ä–æ–≤–∏–Ω–∫–∞',     price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/sinq_blueberry.jpg'}
    ]
  },

  studen_chai:{
    title:'–°–¢–£–î–ï–ù –ß–ê–ô',
    items:[
      {name:'Fuze Tea –ì–æ—Ä—Å–∫–∏ –ø–ª–æ–¥', price:2.50, img:'snimki/produkti/–°–¢–£–î–ï–ù –ß–ê–ô/fuze_tea_forest_frut.jpg'},
      {name:'Fuze Tea –ü—Ä–∞—Å–∫–æ–≤–∞',    price:2.50, img:'snimki/produkti/–°–¢–£–î–ï–ù –ß–ê–ô/fuze_tea_praskova.jpg'}
    ]
  },

  kola:{
    title:'–ö–û–õ–ê',
    items:[
      {name:'–ö–æ–ª–∞ –ö–µ–Ω',        price:2.00, img:'snimki/produkti/–ö–û–õ–ê/kolaken.jpg'},
      {name:'–ö–æ–ª–∞ –ö–µ–Ω Zero',   price:2.00, img:'snimki/produkti/–ö–û–õ–ê/kolakenzero.jpg'},
      {name:'–ö–æ–ª–∞ –ë—É—Ç–∏–ª–∫–∞',    price:2.50, img:'snimki/produkti/–ö–û–õ–ê/kolapvc.jpg'},
      {name:'–ö–æ–ª–∞ –ë—É—Ç–∏–ª–∫–∞ Zero',price:2.50, img:'snimki/produkti/–ö–û–õ–ê/kolapvczero.jpg'}
    ]
  },

  sok:{
    title:'–°–û–ö',
    items:[
      {name:'Cappy –ü–æ—Ä—Ç–æ–∫–∞–ª', price:2.50, img:'snimki/produkti/–°–û–ö/cappy_orange.jpg'},
      {name:'Cappy –õ–∏–º–æ–Ω',    price:2.50, img:'snimki/produkti/–°–û–ö/cappy_lemon.jpg'}
    ]
  },

  airqn:{
    title:'–ê–ô–†–Ø–ù',
    groups:[
      { heading:'–í–µ—Ä–µ—è', items:[
          {name:'–ê–π—Ä—è–Ω –í–µ—Ä–µ—è –ì–æ–ª—è–º', price:2.00, img:'snimki/produkti/–ê–ô–†–ê–ù/airan_vereq_golqm.jpg'},
          {name:'–ê–π—Ä—è–Ω –í–µ—Ä–µ—è –ú–∞–ª—ä–∫', price:1.50, img:'snimki/produkti/–ê–ô–†–ê–ù/airan_vereq_maluk.jpg'}
      ]},
      { heading:'Meggle', items:[
          {name:'–ê–π—Ä—è–Ω Meggle –ë—É—Ç–∏–ª–∫–∞', price:2.00, img:'snimki/produkti/–ê–ô–†–ê–ù/megle_airan_butilka.jpg'},
          {name:'–ê–π—Ä—è–Ω Meggle –ö–æ—Ñ–∞',    price:2.50, img:'snimki/produkti/–ê–ô–†–ê–ù/megle_airan_kofa.jpg'},
          {name:'–ê–π—Ä—è–Ω Meggle –ü–ª–æ–¥–æ–≤',  price:2.20, img:'snimki/produkti/–ê–ô–†–ê–ù/mwgle_airan_plodov.jpg'}
      ]}
    ]
  },

  xixo:{
    title:'XIXO',
    items:[
      {name:'XIXO Cola',               price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_cola.jpg'},
      {name:'XIXO Cherry Cola',        price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_cherry_cola.jpg'},
      {name:'XIXO –î–∏–Ω—è',               price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_dinq.jpg'},
      {name:'XIXO –ì–æ—Ä—Å–∫–∏ –ø–ª–æ–¥',        price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_gorski_plod.jpg'},
      {name:'XIXO Green Fusion',       price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_green_fusion.jpg'},
      {name:'XIXO –ö—Ä—É—à–∞',              price:1.10, img:'snimki/produ–∫—Ç–∏/–•–ò–•–û/xixo_krusha.jpg'},
      {name:'XIXO –õ–∏–º–æ–Ω',              price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_limon.jpg'},
      {name:'XIXO –ú–∞–Ω–≥–æ –∏ –∞–Ω–∞–Ω–∞—Å',     price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_mango_and_pineapple.jpg'},
      {name:'XIXO –†–æ–∑–æ–≤–∞ –ª–∏–º–æ–Ω–∞–¥–∞',    price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_pink_lemonade.jpg'},
      {name:'XIXO –ü—Ä–∞—Å–∫–æ–≤–∞',           price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_praskova.jpg'},
      {name:'XIXO –Ø–≥–æ–¥–∞',              price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_qgoda.jpg'},
      {name:'XIXO Tutti Frutti',       price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_tuti_fruity.jpg'}
    ]
  }
};

/* –ü–æ–¥—Ä–µ–¥–±–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏—Ç–µ */
const ORDER = [
  'burgeri','palachinki','strandzhanki','kartofi','salati','portsii','dobavki',
  'hell','voda','gazirana_voda','fanta','studen_chai','kola','sok','xixo','airqn'
];

const sidebar = document.getElementById('sidebar');
const grid    = document.getElementById('productGrid');
const titleEl = document.getElementById('catTitle');

/* –°–∞–π–¥–±–∞—Ä —Ä–µ–Ω–¥–µ—Ä */
sidebar.innerHTML = ORDER.map(key=>{
  const label = CATALOG[key].title;
  const img   = CAT_THUMBS[key];
  return `<a class="cat" data-cat="${key}" role="link" tabindex="0" aria-label="${label}">
            <div class="box" style="background-image:url('${img}')" data-label="${label}"></div>
          </a>`;
}).join('');

/* pretty label –∑–∞ HELL */
function prettyLabel(src){
  let f = src.split('/').pop().split('.')[0].toLowerCase();
  f = f.replace(/^hell_/, '').replace(/^ice_coffe_/, '').replace(/^ice_hell_/, '');
  const map = {
    apple:'Apple', clasic:'Classic', classic:'Black Cherry',
    redgrape:'Red Grape', watermelon:'Watermelon',
    capochino:'Cappuccino', cappuccino:'Cappuccino', caramel:'Salted Caramel',
    coconut:'Coconut', doubleespresso:'Double Espresso', doublespresso:'Double Espresso',
    late:'Latte', latte:'Latte', pinklatte:'Pink Latte',
    vanilia:'Vanilla', vanilla:'Vanilla', distachio:'Pistachio', pistachio:'Pistachio',
    slimvanilla:'Vanilla'
  };
  if (map[f]) return map[f];
  return f.replace(/[_-]+/g,' ').replace(/\b\w/g, m=>m.toUpperCase());
}

/* ===== –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è + —Ä–µ–Ω–¥–µ—Ä ===== */
let current = null;

function productCardHTML(it, i){
  return `
  <article class="product ${i%2? 'even':''}">
    <div class="photo" style="background-image:url('${it.img}')"></div>
    <div class="pad">
      <h3 class="title">${it.name}</h3>
      <div class="price-badge">
        <div class="lv">${fmtLv(it.price)}</div>
        <div class="eur">${fmtEur(it.price)}</div>
      </div>
      <button class="add-btn" data-name="${it.name.replace(/"/g,'&quot;')}" data-price="${it.price}" data-img="${it.img}">+</button>
    </div>
  </article>`;
}

function activate(cat, {fromNav=false, replace=false} = {}){
  const exists = !!CATALOG[cat];
  if(!exists) cat = 'burgeri';
  current = cat;

  sidebar.querySelectorAll('.cat').forEach(c=>c.classList.toggle('active', c.dataset.cat===cat));
  titleEl.textContent = CATALOG[cat]?.title || cat.toUpperCase();

  const url = new URL(location.href);
  if (url.searchParams.get('cat') !== cat) {
    url.searchParams.set('cat', cat);
    if (replace) history.replaceState({cat}, '', url);
    else if (fromNav) history.pushState({cat}, '', url);
  }

  const data = CATALOG[cat];

  if (data.view === 'water2') {
    grid.innerHTML = `
      <div class="water-wrapper">
        ${data.groups.map(g=>`
          <section class="water-block">
            <h2>${g.heading}</h2>
            <div class="water-grid">
              ${g.pair.map(p=>`
                <div class="water-card">
                  <img src="${p.src}" alt="${p.label}">
                  <div class="water-name">${p.label}</div>
                  ${typeof p.price === 'number' ? `
                    <div class="price-badge">
                      <div class="lv">${fmtLv(p.price)}</div>
                      <div class="eur">${fmtEur(p.price)}</div>
                    </div>
                    <button class="add-btn" data-name="${p.label.replace(/"/g,'&quot;')}" data-price="${p.price}" data-img="${p.src}">+</button>
                  ` : ``}
                </div>
              `).join('')}
            </div>
          </section>
        `).join('')}
      </div>
    `;
    bindAddButtons();
    return;
  }

  if (data.view === 'gallery') {
    const hellPrice = data.hellPrice ?? 2.00;
    grid.innerHTML = data.groups.map(group=>{
      const pics = group.images.map(src=>{
        const label = prettyLabel(src);
        return `
        <div>
          <div class="tile">
            <img src="${src}" alt="${label}">
            <div class="price-badge">
              <div class="lv">${fmtLv(hellPrice)}</div>
              <div class="eur">${fmtEur(hellPrice)}</div>
            </div>
            <button class="add-btn" data-name="${label.replace(/"/g,'&quot;')}" data-price="${hellPrice}" data-img="${src}">+</button>
          </div>
          <div class="caption">${label}</div>
        </div>`;
      }).join('');
      return `
        <h2 class="sec-title">${group.heading}</h2>
        <div class="gallery">${pics}</div>
      `;
    }).join('');
    bindAddButtons();
    return;
  }

  if (data.groups && Array.isArray(data.groups)) {
    const groupsHTML = data.groups.map(group => `
      <h2 class="sec-title">${group.heading}</h2>
      <div class="grid-products">
        ${group.items?.map((it,i)=> productCardHTML(it,i)).join('')||''}
      </div>
    `).join('');
    grid.innerHTML = groupsHTML;
    bindAddButtons();
    return;
  }

  const items = (data?.items)||[];
  if (items.length === 0) {
    grid.innerHTML = `<p style="padding:16px;font-weight:700">–ù—è–º–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ —Ç–∞–∑–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è.</p>`;
    return;
  }
  grid.innerHTML = `
    <div class="grid-products">
      ${items.map((it,i)=> productCardHTML(it,i)).join('')}
    </div>
  `;
  bindAddButtons();
}

/* –î–æ–±–∞–≤—è–Ω–µ ‚Äì —Å–ª—É—à–∞—Ç–µ–ª–∏ */
function bindAddButtons(){
  grid.querySelectorAll('.add-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const name = btn.getAttribute('data-name');
      const price = Number(btn.getAttribute('data-price')) || 0;
      const img = btn.getAttribute('data-img') || '';
      addToCart({ _id: Date.now()+''+Math.random(), name, price, img });
      btn.textContent = '‚úì';
      setTimeout(()=> btn.textContent = '+', 450);
    });
  });
}

/* POP DELAY –≤ —Å–∞–π–¥–±–∞—Ä–∞ */
const POP_DELAY = 100; // ms
function shouldBypassDelay(evt){ return evt.metaKey || evt.ctrlKey || evt.shiftKey || evt.altKey || evt.button === 1; }
function popThenActivate(el, key){
  el.classList.remove('is-pressed'); el.classList.add('is-popping'); el.dataset.locked = '1';
  setTimeout(()=>{ activate(key, {fromNav:true}); el.classList.remove('is-popping'); delete el.dataset.locked; }, POP_DELAY);
}

/* –ß–µ—Ç–∏ cat –æ—Ç URL –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ */
function initFromURL(){
  const params = new URLSearchParams(location.search);
  const cat = params.get('cat') || 'burgeri';
  activate(cat, {replace:true});
}
initFromURL();

/* –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –∫–æ–ª–∏—á–∫–∞—Ç–∞ –ø—Ä–∏ –ø—ä—Ä–≤–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ (–∞–∫–æ –∏–º–∞ –ø—Ä–µ–¥–∏—à–Ω–∞ —Å–µ—Å–∏—è) */
restoreCartFromLS();

/* –°—ä–±–∏—Ç–∏—è –∑–∞ —Å–∞–π–¥–±–∞—Ä –∫–∞—Ä—Ç–∏—Ç–µ */
sidebar.querySelectorAll('.cat').forEach(catEl=>{
  const key = catEl.dataset.cat;
  catEl.addEventListener('touchstart', ()=>{ catEl.classList.add('is-pressed'); setTimeout(()=>catEl.classList.remove('is-pressed'), 120); }, {passive:true});
  catEl.addEventListener('mousedown', ()=>catEl.classList.add('is-pressed'));
  catEl.addEventListener('mouseleave', ()=>catEl.classList.remove('is-pressed'));
  catEl.addEventListener('mouseup',   ()=>catEl.classList.remove('is-pressed'));
  catEl.addEventListener('click', (e)=>{ if (shouldBypassDelay(e)) return; e.preventDefault(); if (catEl.dataset.locked==='1'|| key===current) return; popThenActivate(catEl, key); });
  catEl.addEventListener('keydown', (e)=>{ if (e.key==='Enter'||e.key===' '){ e.preventDefault(); if (catEl.dataset.locked==='1'|| key===current) return; popThenActivate(catEl, key);} });
});

/* Back/Forward */
addEventListener('popstate', (e)=>{
  const cat = (e.state && e.state.cat) || new URLSearchParams(location.search).get('cat') || 'burgeri';
  activate(cat, {replace:true});
});

/* –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–æ–≤–µ –ø—Ä–∏ pageshow (–∞–∫–æ —Å–µ –≤—ä—Ä–Ω–µ–º) */
addEventListener('pageshow', ()=>{
  sidebar.querySelectorAll('.cat').forEach(c=>{ c.classList.remove('is-pressed','is-popping'); delete c.dataset.locked; });
});

/* –ü–ª–∞–≤–∞—â–æ –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ –±—É—Ç–æ–Ω–∞ ‚Äû–ù–∞—á–∞–ª–æ‚Äú */
(function(){
  const home = document.querySelector('.home-pill');
  const content = document.querySelector('.content');
  if(!home || !content) return;

  const TOP = 16, BOTTOM_MARGIN = 16, SPEED = 0.25;
  let cur = 0, target = 0, rafId = 0;

  function maxShift(){ return Math.max(0, window.innerHeight - TOP - BOTTOM_MARGIN - home.offsetHeight); }
  function updateLeft(){
    const rect = content.getBoundingClientRect();
    home.style.left = (rect.left + 20) + 'px';
  }
  function onScroll(){
    const doc = document.documentElement;
    const scrollMax = Math.max(1, doc.scrollHeight - window.innerHeight);
    const progress = window.scrollY / scrollMax;
    target = progress * maxShift();
    if(!rafId) rafId = requestAnimationFrame(tick);
  }
  function tick(){
    rafId = 0;
    cur += (target - cur) * SPEED;
    home.style.transform = `translateY(${cur.toFixed(2)}px)`;
    if (Math.abs(target - cur) > 0.5) rafId = requestAnimationFrame(tick);
  }
  addEventListener('scroll', onScroll, {passive:true});
  addEventListener('resize', ()=>{ updateLeft(); onScroll(); });
  updateLeft(); onScroll();
})();

/* HOME —Å–ø–æ—Ä–µ–¥ —Å—Ä–µ–¥–∞—Ç–∞ (file:// –∏–ª–∏ web) */
(function(){
  const home = document.querySelector('.home-pill');
  if (!home) return;
  const HOME_LOCAL = 'file:///E:/BBQ_SITE/index.html';
  const HOME_WEB   = 'index.html';
  home.addEventListener('click', function(e){
    if (e.ctrlKey || e.metaKey || e.shiftKey || e.altKey || e.button === 1) return;
    e.preventDefault();
    const target = (location.protocol === 'file:') ? HOME_LOCAL : HOME_WEB;
    window.location.href = target;
  });
})();
</script>
</body>
</html>
